# 混合策略贪吃蛇 AI （Mixed Strategy Snake AI）

这是一个基于 Python 和 Pygame 实现的高级贪吃蛇 AI。与传统的单一策略 AI 不同，本项目采用了一种动态的、多策略混合的决策系统。AI 能够根据当前的游戏局势，在多种预设算法（如 A*、哈密顿循环、MCTS）中进行智能选择，并通过简单的强化学习机制动态调整不同算法的权重，以期达到更高的生存率和得分。

项目最大的特点是带有一个实时的“AI 监视器”面板，该面板可以可视化 AI 的完整“思考过程”，包括各个算法的评分、当前的权重、最终的决策等，为理解和调试 AI 行为提供了极大的便利。

## 主要特性

- **混合决策引擎**: AI 不是依赖单一算法，而是整合了多种算法，每个算法在决策时都会提出自己的“方案”和“信心分数”。
- **动态权重学习**: AI 会根据每一步决策带来的结果（吃到食物为正反馈，游戏结束为负反馈）动态调整其对各个算法的“信任度”（权重），实现简单的自适应学习。
- **实时 AI 监控面板**: 游戏窗口右侧的面板会实时展示 AI 的内部状态，包括：
    - 当前得分、蛇长、可用空间
    - 各个备选算法的实时评分
    - 最终被采纳的算法
    - 动态变化的“大脑权重”
- **核心算法库**:
    - **A\* 智能寻路**: 高效寻找前往食物的最短路径。
    - **路径安全评估**: 在 A\* 寻路后，会模拟吃掉食物后的情况，评估是否存在被困风险，避免为了吃而陷入绝境。
    - **哈密顿循环**: 一种保守的生存策略，通过沿预设的、能填满整个空间的路径移动，在找不到食物或局势危险时保证生存。
    - **蒙特卡洛树搜索 (MCTS)**: 一种强大的前瞻性搜索算法，在 A\* 等直接策略失效时，通过大量模拟来探索未来的可能性，寻找最优解。
    - **贪心生存算法**: 一种最基本的保底策略，选择能使下一步拥有最大可移动空间的移动方向。

## 架构与工作流程

AI 的核心位于 `agent.py` 中的 `AIController` 类。其每一帧的决策流程如下：

### 1. 方案提出 (Proposal)

在每个决策点，控制器会请求所有内置算法模块提供行动方案和信心分数。

- **`A_STAR`**: 调用 `a_star_pathfinding` 寻找食物路径。如果找到路径，并且 `is_path_safe` 函数评估认为路径是安全的，则给出高分 (100)；否则给出负分。
- **`HAMILTONIAN`**: 当 `_calculate_space_size` 检测到蛇的生存空间变得狭窄时，此算法会获得较高分数 (80)，表明应切换到保守的生存模式。
- **`MCTS`**: 当 A\* 寻路失败时，MCTS 作为强大的备用方案被激活，获得高分 (90)。它会通过 `mcts_search` 进行深度模拟，找到一个“看起来”最安全的长期移动方向。
- **`SURVIVAL`**: 贪心生存算法作为一个永远可用的基础选项，始终提供一个较低的基础分 (20)。

### 2. 加权决策 (Weighted Decision)

控制器维护一个权重字典 `self.weights`，代表了它对每个算法历史表现的“信任度”。

最终分数计算公式为：
`final_score = confidence_score * weight`

控制器会选择 `final_score` 最高的算法作为本轮的最终决策。

### 3. 执行与反馈 (Execution & Feedback)

- 控制器执行被选中算法所建议的移动 `action`。
- 游戏主循环 `game.play_step` 返回该步带来的奖励 `reward`（吃到食物为正，死亡为负）。
- 控制器调用 `update_weights` 方法，根据 `reward` 的正负来微调被选中算法的权重。如果成功，权重增加 (x1.02)；如果失败，权重降低 (x0.98)。

这个流程形成了一个完整的“感知-思考-决策-学习”闭环。

## 文件结构

```
.
├── main.py          # 主程序入口，负责启动和管理游戏循环。
├── game.py          # 核心游戏逻辑，使用Pygame进行渲染，并包含AI监控面板的UI绘制。
├── agent.py         # AI的大脑，实现了混合策略决策和权重更新的核心逻辑。
├── algorithms.py    # 存放了A*、哈密顿循环、贪心生存算法以及路径安全评估等函数的具体实现。
├── mcts.py          # 蒙特卡洛树搜索（MCTS）算法的完整实现。
├── config.py        # 配置文件，包含窗口尺寸、颜色、游戏速度等常量。
└── README.md        # 本文档。
```

## 如何运行

### 环境要求

- Python 3.x
- Pygame 库

### 安装依赖

首先，请确保你已经安装了 Pygame。如果尚未安装，可以通过 pip 进行安装：
```bash
pip install pygame
```

### 启动游戏

直接运行 `main.py` 文件即可启动游戏。
```bash
python main.py
```
程序将自动运行，你可以在窗口中观察 AI 的表现以及右侧监控面板的数据变化。

## 代码细节说明

- **`game.py` 中的 `simulate_step` 方法**: 这是一个特殊的方法，它允许 MCTS 等算法在不改变真实游戏状态的情况下，对未来的移动进行模拟和推演，并获取模拟结果（奖励、是否结束），这是实现前瞻性算法的关键。
- **`algorithms.py` 中的 `_calculate_space_size` 函数**: 该函数使用广度优先搜索 (BFS) 来计算从蛇头位置出发可以触及的空格总数，是评估当前局面开放性和路径安全性的重要依据。
- **`agent.py` 中的 `debug_info` 字典**: 这个字典是连接 AI 大脑和前端 UI 的桥梁。它将 AI 决策过程中的所有关键数据打包，供 `game.py` 中的 `_draw_panel` 函数进行可视化展示。
```
